#include "../tests/tests.h"
using namespace TestCommon;

#include "../neuralnet/nneval.h"
#include "../dataio/trainingwrite.h"
#include "../program/play.h"

static NNEvaluator* startNNEval(
  const string& seed, Logger& logger,
  int defaultSymmetry, bool inputsUseNHWC, bool cudaUseNHWC, bool cudaUseFP16
) {
  //Placeholder, doesn't actually do anything since we have debugSkipNeuralNet = true
  string modelFile = "/dev/null";
  int modelFileIdx = 0;
  int maxBatchSize = 16;
  int posLen = NNPos::MAX_BOARD_LEN;
  bool requireExactPosLen = false;
  int nnCacheSizePowerOfTwo = 16;
  int nnMutexPoolSizePowerOfTwo = 12;
  bool debugSkipNeuralNet = true;
  NNEvaluator* nnEval = new NNEvaluator(
    modelFile,
    modelFileIdx,
    maxBatchSize,
    posLen,
    requireExactPosLen,
    inputsUseNHWC,
    nnCacheSizePowerOfTwo,
    nnMutexPoolSizePowerOfTwo,
    debugSkipNeuralNet
  );
  (void)inputsUseNHWC;

  int numNNServerThreadsPerModel = 1;
  bool nnRandomize = false;
  vector<int> cudaGpuIdxByServerThread = {0};

  nnEval->spawnServerThreads(
    numNNServerThreadsPerModel,
    nnRandomize,
    seed,
    defaultSymmetry,
    logger,
    cudaGpuIdxByServerThread,
    cudaUseFP16,
    cudaUseNHWC
  );

  return nnEval;
}

void Tests::runTrainingWriteTests() {
  cout << "Running training write tests" << endl;
  string tensorflowGpuVisibleDeviceList = "";
  double tensorflowPerProcessGpuMemoryFraction = 0.3;
  NeuralNet::globalInitialize(tensorflowGpuVisibleDeviceList,tensorflowPerProcessGpuMemoryFraction);

  int inputsVersion = 3;
  int maxRows = 256;
  int posLen = 5;
  double firstFileMinRandProp = 1.0;
  int debugOnlyWriteEvery = 5;

  ostringstream out;
  Logger logger;
  logger.setLogToStdout(false);
  logger.setLogTime(false);
  logger.addOStream(out);

  auto run = [&](const string& seedBase, const Rules& rules) {
    TrainingDataWriter dataWriter(&out,inputsVersion, maxRows, firstFileMinRandProp, posLen, debugOnlyWriteEvery, seedBase+"dwriter");

    NNEvaluator* nnEval = startNNEval(seedBase+"nneval",logger,0,true,false,false);

    SearchParams params;
    params.maxVisits = 100;

    MatchPairer::BotSpec botSpec;
    botSpec.botIdx = 0;
    botSpec.botName = string("test");
    botSpec.nnEval = nnEval;
    botSpec.baseParams = params;

    Board initialBoard(5,5);
    Player initialPla = P_BLACK;
    int initialEncorePhase = 0;
    BoardHistory initialHist(initialBoard,initialPla,rules,initialEncorePhase);

    int numExtraBlack = 0;
    bool doEndGameIfAllPassAlive = true;
    bool clearBotAfterSearch = true;
    int maxMovesPerGame = 40;
    vector<std::atomic<bool>*> stopConditions;
    FancyModes fancyModes;
    fancyModes.initGamesWithPolicy = true;
    fancyModes.forkSidePositionProb = 0.10;
    bool recordFullData = true;
    Rand rand(seedBase+"play");
    FinishedGameData* gameData = Play::runGame(
      initialBoard,initialPla,initialHist,numExtraBlack,
      botSpec,botSpec,
      seedBase+"search",
      doEndGameIfAllPassAlive, clearBotAfterSearch,
      logger, false, false,
      maxMovesPerGame, stopConditions,
      fancyModes, recordFullData, posLen,
      rand
    );

    out << gameData->startHist.getRecentBoard(0) << endl;
    gameData->endHist.printDebugInfo(out,gameData->endHist.getRecentBoard(0));

    dataWriter.writeGame(*gameData);
    delete gameData;

    dataWriter.flushIfNonempty();

    delete nnEval;
  };

  run("testtrainingwrite-tt",Rules::getTrompTaylorish());

  Rules rules;
  rules.koRule = Rules::KO_SIMPLE;
  rules.scoringRule = Rules::SCORING_TERRITORY;
  rules.multiStoneSuicideLegal = false;
  rules.komi = 5;
  run("testtrainingwrite-jp",rules);

  string expected = R"%%(
HASH: B44BCAB22E9522EDAA7A623B5E9DA71F
   A B C D E
 5 . . . . .
 4 . . . . .
 3 . . . . .
 2 . . O . .
 1 . . . X .


HASH: B0648DD012BD88A09A10B97982A80C71
   A B C D E
 5 O . O X .
 4 O O O X O
 3 O O O X O
 2 O O O O O
 1 O O . . O


Encore phase 0
Rules koPOSITIONALscoreAREAsui1komi7.5
Ko prohib hash 00000000000000000000000000000000
White bonus score 0
Game result 0 Empty 0 0
Last moves D1 C2 E1 C4 D4 A3 C3 B1 D5 C5 D3 E2 B5 D2 A1 E4 A5 B2 C1 B4 E3 E5 C1 pass D1 B3 A2 E1 D1 A4 E5 A1 B5 E4 D3 C3 D4 A2 D5 A5 C1 E3
binaryInputNCHWPacked
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|u1','fortran_order':False,'shape':(9,22,4)}
FFFFFF80000001000000400000000000000000000000010000000000000000000000000000004000000001000000000000000000000000000000000000000000000000000000000000000100000040000000000000000000
FFFFFF800120400000880180000000000108000000A0418000000000000000000000000000080000002000000080000001000000000000800108000000000000000000000004000001204000008801800000000000000000
FFFFFF80108C018021205400000000002100118000204400000000000000000000000000000010000004000020000000100000000000040021001180210000002108000002002000108C0180212054000000000000000000
FFFFFF8021607400D08C098021000980C040040010AC70000000000000000000000000008000000000400000000008000000200040000000C040098040400980400009800200000021607400D08C09800000000000000000
FFFFFF80D08E08002320F400C00008002300000010AE00000000000000000000000000000800000000020000020000000000020000008000C0000800D0CE0800C040080000000000D8CE08002320F7800000000000000000
FFFFFF802330F400D08E0300C0000300108E0000000000000000000000000000000000000001000000100000000001000000000000000200D08E0300D08E0B00C0000B0008400000E731FF8018CE00000000000000000000
FFFFFF80188E01002730FC80188E010000000000000000000000000000000000000000000000080008000000040000000000010000000080188E0100188E0100108E01000000000018CE0000E731FF800000000000000000
FFFFFF802778FC80408401004000010000C4000000000000000000000000000000000000008000000008000000040000004000004000000040840100400401004000010010020000E779FF80008400000000000000000000
FFFFFF80108C018029204400080000002100000000204580000000000000000000000000080000000004000020000000100000000000040029000000210000002108000002000000108C0180292044000000000000000000

globalInputNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(9,14)}
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 1 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5

policyTargetsNCMove
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<i2','fortran_order':False,'shape':(9,1,26)}
3 0 3 0 0 0 19 12 0 0 0 0 0 0 0 0 7 0 0 0 0 8 10 0 37 0
12 0 9 0 1 0 0 0 0 0 0 9 0 7 7 4 0 0 4 9 0 27 10 0 0 0
0 24 0 0 0 8 6 0 0 15 0 0 0 0 15 0 5 0 8 0 8 0 0 0 0 10
0 0 0 0 14 3 0 0 0 0 0 10 0 0 4 6 36 0 0 0 0 0 3 0 0 23
0 0 0 0 5 4 0 0 0 15 0 23 0 0 0 6 0 0 0 0 0 0 29 1 16 0
0 0 0 0 1 22 0 0 0 6 0 0 0 0 0 14 0 0 0 0 1 0 0 0 36 19
7 88 0 0 0 0 0 0 0 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
10 0 0 20 9 0 0 0 0 0 0 0 0 0 7 35 0 0 0 0 0 0 0 0 0 18
0 5 0 0 0 3 7 0 0 0 0 4 0 0 5 11 4 0 14 0 42 0 4 0 0 0

globalTargetsNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(9,50)}
0 1 0 -0.80997 0.222029 0.553214 0 -0.262477 0.318982 0.357223 0 -0.0249417 0.330439 0.335928 0 -8.14553e-06 0.339011 0.324423 0 -0 -32.5 0.00190583 0.00122793 0.000418241 0.000279786 1 1 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 0 1 2 0 0 0 0
1 0 0 0.80997 0.585766 0.205752 0 0.302178 0.367821 0.313022 0 0.0385362 0.333208 0.328833 0 3.43252e-05 0.336813 0.329519 0 0 32.5 0.0132042 0.00215569 0.000176993 3.20283e-06 1 1 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 5 1 2 0 0 0 0
0 1 0 -0.80997 0.187129 0.624112 0 -0.347884 0.304388 0.387136 0 -0.0595404 0.328838 0.334169 0 -0.000144646 0.327427 0.328379 0 -0 -32.5 2.43174e-05 8.53189e-05 4.09926e-05 5.9302e-05 1 1 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 10 1 2 0 0 0 0
1 0 0 0.80997 0.668192 0.165628 0 0.400504 0.416864 0.290791 0 0.091993 0.340508 0.32695 0 0.000609537 0.334632 0.321218 0 0 32.5 0.00229696 0.00535769 0.00213408 7.79794e-05 1 1 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 15 1 2 0 0 0 0
0 1 0 -0.80997 0.141067 0.7178 0 -0.461084 0.27061 0.45877 0 -0.142134 0.326425 0.344967 0 -0.00256859 0.323355 0.343677 0 -0 -32.5 0.00547405 0.0109101 0.00164604 0.00121282 1 1 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 20 1 2 0 0 0 0
1 0 0 0.80997 0.774595 0.112717 0 0.530826 0.52206 0.239372 0 0.219604 0.349379 0.327157 0 0.010824 0.331866 0.336492 0 0 32.5 7.08415e-05 0.000787751 0.0018702 1.1548e-05 1 1 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 25 1 2 0 0 0 0
0 1 0 -0.80997 0.0796434 0.840091 0 -0.611117 0.189086 0.620615 0 -0.339299 0.310146 0.379344 0 -0.0456122 0.336678 0.333106 0 -0 -32.5 0.00323288 0.00285524 8.63613e-05 0.000112105 1 1 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 30 1 2 0 0 0 0
1 0 0 0.80997 0.915574 0.0419146 0 0.703552 0.773248 0.11258 0 0.524235 0.509166 0.243741 0 0.19221 0.344844 0.323487 0 0 32.5 0.00568557 0.000279997 0.000155811 0.000368905 1 1 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 35 1 2 0 0 0 0
0.329615 0.325924 0.344461 0.00897861 0.329615 0.325924 0.344461 0.00897861 0.329615 0.325924 0.344461 0.00897861 0.329615 0.325924 0.344461 0.00897861 0.329615 0.325924 0.344461 0.00897861 0 5.68198e-05 0.000656803 0.000101583 0.000256458 1 0 1 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 10 1 2 0 0 0 1

scoreDistrN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,80)}
0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0
0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0
0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0
0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

selfBonusScoreN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,61)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

valueTargetsNCHW
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,1,5,5)}
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

HASH: 6C551B368DDA0C4D7310D9E43A2B282D
   A B C D E
 5 . . . . .
 4 . . . . .
 3 . . . . .
 2 . . . . .
 1 . . . . .


HASH: 1D4E854C483AFE31F16EFE4EB3CE9ED7
   A B C D E
 5 . X . X .
 4 O O X X .
 3 X O X X .
 2 X X X X O
 1 . X . X .


Encore phase 0
Rules koSIMPLEscoreTERRITORYsui0komi5
Ko prohib hash 00000000000000000000000000000000
White bonus score 1
Game result 1 Black -19 0
Last moves E5 B4 C4 E4 D1 C1 A2 E3 B2 A4 D3 pass D4 C5 B1 D5 B5 pass A3 E2 C3 E5 pass B3 pass E1 D2 E2 C2 C5 D5
binaryInputNCHWPacked
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|u1','fortran_order':False,'shape':(8,22,4)}
FFFFFF80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
FFFFFF80024000000900010008000000004000000300010000000000000000000000000000000100004000000100000002000000080000000840000008400000080000000000000000000000000000000000000000000000
FFFFFF80090181000642020008000000000003000142000000000000000000000000000004000000000080000002000000010000000002000800030008000300080003000000400000000000000000000000000000000000
FFFFFF80264202000985850008420200200001000184000000000000000000000000000000000400200000000080000000000000000400002042020020420300004203000000000000000000000000000000000000000000
FFFFFF8041A585003642120070000200078401000063940000000000000000000000000000001000002000000000000040000000100000000600020006420200004202000010000000000000000000000000000000000000
FFFFFF803E52120041AD85004610020039EF95000000000000000000000000000000000000000000001000000000000008000000000800003E5212003E5212007E4212000000000000000000000000000000000000000000
FFFFFF8041ADE5002610100066100000000010000000000000000000000000000000000020000000000040000000100000002000000000802610100006101000061012000002008001ADEF00000000000000000000000000
FFFFFF80090280008244000008420000800000000304000000000000000000000000000000400000000200000004000000008000800000000000000008020000080000000000000000000000000000000000000000000000

globalInputNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(8,14)}
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 0.4 0 0 0 1 0 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 1 0 0.466667 0 0 0 1 0 0 0 0
0 0 1 0 0 -0.466667 0 0 0 1 0 0 0 0
1 0 1 0 0 0.4 0 0 0 1 0 0 1 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0

policyTargetsNCMove
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<i2','fortran_order':False,'shape':(8,1,26)}
18 0 0 12 22 3 0 0 9 1 7 0 0 6 12 0 0 0 9 0 0 0 0 0 0 0
12 0 5 0 0 0 0 0 0 0 8 5 0 11 0 10 2 6 6 0 8 0 26 0 0 0
10 9 12 0 0 0 0 0 4 0 4 7 8 18 0 0 0 2 0 0 10 0 0 0 5 10
9 26 0 30 0 0 0 0 0 0 0 17 0 0 0 0 0 12 4 0 0 0 0 0 1 0
0 0 0 0 6 0 0 0 0 0 0 16 34 0 0 0 0 3 24 0 0 0 0 0 3 13
26 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 7 0 0 0 0 0 39 25
0 0 0 33 5 0 0 0 0 10 0 0 0 0 0 0 0 0 0 0 12 0 0 0 22 17
0 5 0 1 0 0 0 0 6 0 32 2 2 0 0 9 0 0 5 9 2 7 5 1 13 0

globalTargetsNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(8,50)}
1 0 0 0.691429 0.610264 0.195918 0 0.288722 0.376394 0.313232 0 0.046591 0.332434 0.335638 0 9.26077e-05 0.336624 0.334951 0 0 19 0.00142905 0.00282358 0.000616458 8.98271e-09 1 1 1 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 0 0 0 0 0 0 0
0 1 0 -0.691429 0.174732 0.652329 0 -0.332393 0.300855 0.40037 0 -0.0719855 0.334995 0.329957 0 -0.000390248 0.334171 0.324916 0 -0 -19 0.0652504 0.000320708 0.000340017 0.00014013 1 1 1 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 5 0 0 0 0 0 0
1 0 0 0.691429 0.700939 0.15055 0 0.38267 0.438454 0.282312 0 0.111221 0.333047 0.332979 0 0.0016445 0.33023 0.332782 0 0 19 0.0181524 4.28383e-05 2.08325e-05 1.72326e-06 1 1 1 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 10 0 0 0 0 0 0
0 1 0 -0.691429 0.12307 0.756977 0 -0.440551 0.255138 0.49724 0 -0.171843 0.336106 0.339646 0 -0.00692992 0.335042 0.330936 0 -0 -19 0.00305486 0.00688419 0.00120538 8.16872e-05 1 1 1 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 7 0 0 0 15 0 0 0 0 0 0
1 0 0 0.691429 0.820825 0.0902756 0 0.507188 0.58575 0.209061 0 0.265506 0.355562 0.326795 0 0.0292026 0.328326 0.345082 0 0 19 0.000980018 0.000116875 6.64598e-05 0.00103012 1 1 1 0 0 0 0 0 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -7 0 0 0 20 0 0 0 0 0 0
0 1 0 -0.691429 0.0522481 0.895611 0 -0.583904 0.136687 0.727102 0 -0.41022 0.276644 0.448988 0 -0.12306 0.341631 0.326621 0 -0 -19 0.00656276 0.000137703 2.16697e-05 0.000318113 1 1 1 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 25 0 0 0 0 0 0
1 0 0 0.691429 0.981176 0.00931828 0 0.672223 0.943527 0.0279549 0 0.63381 0.83058 0.0838646 0 0.518572 0.32232 0.335458 0 0 19 0.00635637 0.00510066 1.98975e-05 0.000256905 1 1 1 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 30 0 0 0 0 0 0
0.328505 0.342301 0.329194 -0.00127634 0.328505 0.342301 0.329194 -0.00127634 0.328505 0.342301 0.329194 -0.00127634 0.328505 0.342301 0.329194 -0.00127634 0.328505 0.342301 0.329194 -0.00127634 0 0.00167081 2.61522e-05 0.000196835 0.000258171 1 0 1 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 8 0 0 0 0 0 1

scoreDistrN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,80)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

selfBonusScoreN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,61)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

valueTargetsNCHW
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,1,5,5)}
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

)%%";
  expect("Test training write",out,expected);



  NeuralNet::globalCleanup();
}
